-----------------------------------------------------描述: 玩家合成网络消息处理及其逻辑--时间: 2012.3.26--作者: xxj---------------------------------------------------MsgCompose = {}local p = MsgCompose;local COMPOSE_ACTION_EQUIP_COMPOSE				= 0;local COMPOSE_ACTION_FORMULA_COMPOSE			= 1;local COMPOSE_ACTION_MSG_REPLY			        = 2;function p.SendComposeAction(formulaID)   LogInfo("p.SendComposeAction[%d]", formulaID);  local netdata = createNDTransData(NMSG_Type._MSG_START_FORMULA_DATA);  if nil == netdata then		LogInfo("发送合成消息失败,内存不够");		return false;  end  local material1ItemType=GetDataBaseDataN("formulatype",formulaID,DB_FORMULATYPE.MATERIAL1);  local nType = ItemFunc.GetType(material1ItemType);  if nType == Item.TypeInvalid then    LogInfo("p.AttachItemInfo nType == Item.TypeInvalid");	netdata:Free();	return false;  elseif nType == Item.TypeEquip then    local maxEnhanceItemID = ItemUI.GetMaxEnhanceItemID(material1ItemType);	LogInfo("发送装备合成消息maxEnhanceItemID="..maxEnhanceItemID);	netdata:WriteByte(COMPOSE_ACTION_EQUIP_COMPOSE);	netdata:WriteInt(formulaID);  	netdata:WriteInt(maxEnhanceItemID);   else     LogInfo("发送药品合成消息");	netdata:WriteByte(COMPOSE_ACTION_FORMULA_COMPOSE);	netdata:WriteInt(formulaID);  end  SendMsg(netdata);  netdata:Free();  ShowLoadBar();  return true;end-- 网络消息处理(合成信息)function p.ProcessComposeInfo(netdata)   LogInfo("p.ProcessComposeInfo");  CloseLoadBar();  local act=netdata:ReadByte();  LogInfo("act="..act);  if act==COMPOSE_ACTION_MSG_REPLY then    local scene = GetSMGameScene(); 	if scene ~= nil then	  scene:RemoveChildByTag(NMAINSCENECHILDTAG.PlayerUICompose, true);    end 	local idProduct=netdata:ReadInt();	local btNum=netdata:ReadByte();  endendRegisterNetMsgHandler(NMSG_Type._MSG_START_FORMULA_DATA, "p.ProcessComposeInfo", p.ProcessComposeInfo);
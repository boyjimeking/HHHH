/* *  CPetNode.mm *  DragonDrive * *  Created by jhzheng on 12-1-14. *  Copyright 2012 __MyCompanyName__. All rights reserved. * */#include "CPetNode.h"#include "NDDirector.h"#include "CPet.h"#include "CGPointExtension.h"IMPLEMENT_CLASS(CPetNode, NDUILayer)CPetNode::CPetNode(){	m_role = NULL;		m_pos = CGPointZero;}CPetNode::~CPetNode(){}void CPetNode::Initialization(){	NDUILayer::Initialization();		CGSize winsize = NDDirector::DefaultDirector()->GetWinSize();		this->SetFrameRect(CGRectMake(0, 0, winsize.width, winsize.height));	this->SetBackgroundColor(ccc4(255, 255, 255, 0));	this->SetTouchEnabled(false);}void CPetNode::draw(){	if (!this->IsVisibled() || !m_role) return;		m_role->RunAnimation(true);}void CPetNode::ChangePet(OBJID idPet){	PetInfo* petInfo = PetMgrObj.GetPet(idPet);		if ( !(m_role && m_role->m_id == idPet) )	{		SAFE_DELETE_NODE(m_role);				if (!petInfo) return;				PetInfo::PetData& petData = petInfo->data;				m_role = new NDBaseRole;		m_role->SetNormalAniGroup(petData.int_PET_ATTR_LOOKFACE);		m_role->m_id = idPet;		this->AddChild(m_role);		refeshPosition();	}		// 更新宠物的装备 todo}void CPetNode::SetDisplayPos(CGPoint pos){	m_pos = pos;		refeshPosition();}void CPetNode::refeshPosition(){	if (!m_role) return;		int iH = m_role->GetHeight()-32;		iH = iH < 7 ? iH + 15 : iH;		m_role->SetPositionEx(ccp(m_pos.x, m_pos.y+iH));}